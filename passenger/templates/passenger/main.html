<!DOCTYPE html>
<html lang="en">
<head>
    {% load staticfiles %}
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta charset="UTF-8">
    <title>TAYO</title>
    <script src="{% static 'js/jquery-3.1.0.min.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js"></script>
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <!-- 모바일용 바탕화면 바로가기 아이콘 택없음 -->
    <link href="{% static 'img/tayologo.png' %}" rel="apple-touch-icon-precomposed"></link>
    <!-- 모바일용 바탕화면 바로가기 아이콘(IOS)114*114 -->
    <link href="{% static 'img/tayologo.png' %}" rel="apple-touch-icon"></link>
    <!-- 모바일용 바탕화면 바로가기 아이콘(Android) -->
    <link href="{% static 'img/tayologo.png' %}" rel="shortcut icon"></link>
    <style>
        .academypadding{
          padding: 10px;
        }

    </style>
    <script>
      var userAgent = navigator.userAgent.toLowerCase();

      if(userAgent.match('iphone')) {
        document.write('<link rel="apple-touch-icon" href="/mobile/image/apple-touch-icon.png" />')
      } else if(userAgent.match('ipad')) {
        document.write('<link rel="apple-touch-icon" sizes="72*72" href="/mobile/image/apple-touch-icon-ipad.png" />')
      } else if(userAgent.match('ipod')) {
        document.write('<link rel="apple-touch-icon" href="/mobile/image/apple-touch-icon.png" />')
      } else if(userAgent.match('android')) {
        document.write('<link rel="shortcut icon" href="/mobile/image/favicon.ico" />')
      } else {
        document.write('<link rel="shortcut icon" href="/mobile/image/favicon.ico" />')
      }
    </script>

</head>

<body id="background">
    {% if user.is_authenticated %}
    <!-- <div class="row" style="background-color: white">
        <h4 style="background-color: white">
            <div class="row">
            <p class="text-center" id="top_logo"style="color:rgb(68,114,179)"><img src = "{% static 'img/tayologo.png' %}" class="img-fluid" alt="Responsive image" width="9%"></img> 안전한 어린이통학 전문 서비스</p>
            </div>
        </h4>
</div> -->
    <div class="container">
        <nav class="navbar navbar-default navbar-fixed-top" role="navigation" id="dateNav">
            <div class="container">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <a class="navbar-brand" href="/">
                        <img alt="ShuttleTayo" width="22%" src="{% static 'img/tayologo.png' %}"></img>
                    </a>
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                </div>
                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav navbar-right">
                        <!--
                    <li>
                        <a href="dateSchedule?what=single">학원 일짜별 스케쥴 보기</a>
                    </li>
                    <li>
                        <a href="dateSchedule?what=range">구간별 스케쥴 카운팅</a>
                    </li>
                    -->
                        <li>
                            <a href="#">반갑습니다 {{user.first_name}}님</a>
                        </li>
                        <li>
                            <a href="logout">Logout</a>
                        </li>
                    </ul>
                </div>
                <!-- /.navbar-collapse -->
            </div>
            <!-- /.container -->
        </nav>
    </div>
    <br>
    <br>
    <br>
    <div class="row">
        <div class="col-xs-2 col-sm-4"></div>
        <div class="col-xs-8 col-md-4">
            {% if user.is_staff %}
            <div class="dropdown">
                <button id="cLabel" type="button" class="btn btn-success btn-lg btn-block" data-toggle="dropdown" aria-expanded="true">관리 페이지</button>
                <ul class="dropdown-menu" aria-labelledby="cLabel">
                    {% for academy in academies %} {% if user.first_name = academy.name or user.is_staff %}
                    <li>
                        <a onclick="location.href='safetyTayo?aid={{academy.id}}'">{{academy.name}}</a>
                    </li>
                    {% endif %} {% endfor %}
                </ul>
            </div>
            <br> {% endif %}
            <div class="dropdown">
                <button id="dLabel" type="button" class="btn btn-success btn-lg btn-block" data-toggle="dropdown" aria-expanded="true">학원별 스케줄 보기</button>
                <ul class="dropdown-menu" aria-labelledby="dLabel">
                    {% for academy in academies %} {% if user.first_name = academy.name or user.is_staff %}
                    <li>
                        <a onclick="getDay({{academy.id}})">{{academy.name}}</a>
                    </li>
                    {% endif %} {% endfor %}
                </ul>
            </div>
            <br>
            <div class="dropdown">
                <button id="dLabel" type="button" class="btn btn-danger btn-lg btn-block" aria-expanded="true" onclick="location.href='community'">불편 사례 보기</button>
            </div>
            <br> {% if user.is_staff %}
            <div class="dropdown">
                <button id="dLabel" type="button" class="btn btn-success btn-lg btn-block" data-toggle="dropdown" aria-expanded="true">기사님용 스케줄 보기</button>
                <ul class="dropdown-menu" aria-labelledby="dLabel">
                    {% for group in groups %}
                    <li>
                        <a onclick="getDayDriver({{group.gid}})">{{ group.gname }}</a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            <br> {% if user.is_staff %}
            <button id="dLabel" type="button" class="btn btn-success btn-lg btn-block" data-toggle="dropdown" aria-expanded="true" onclick="location.href='dateSchedule?what=single'">지난 스케줄 보기</button> {% endif %}
            <br> {% if user.is_staff %}
            <div class="dropdown">
                <button id="dLabel" type="button" class="btn btn-info btn-lg btn-block" data-toggle="dropdown" aria-expanded="true">호차별 스케줄 관리(Beta)</button>
                <ul class="dropdown-menu" aria-labelledby="dLabel">
                    {% for group in groups %}
                    <li>
                        <a onclick="updateDay({{group.gid}})">{{ group.gname }}</a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            <br> {% if user.is_staff %}
            <div class="dropdown">
                <button id="dLabel" type="button" class="btn btn-info btn-lg btn-block" data-toggle="dropdown" aria-expanded="true">학원별 스케줄 관리(Beta)</button>
                <ul class="dropdown-menu" aria-labelledby="dLabel">
                    {% for academy in academies %}
                    <li>
                        <a onclick="updateDayAca({{academy.id}})">{{academy.name}}</a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            <br>
            {% if user.is_staff %}
            <div class="dropdown">
                <button id="dLabel" type="button" class="btn btn-info btn-lg btn-block" data-toggle="dropdown" aria-expanded="true" onclick="studata()">학원별 학생 데이터관리(Beta)</button>
            </div>
            {% endif %}
            <br>
            {% if user.is_staff %}
            <div class="dropdown">
                <button id="dLabel" type="button" class="btn btn-info btn-lg btn-block" data-toggle="dropdown" aria-expanded="true">PUT SCHEDULE(alpha)</button>
                <ul class="dropdown-menu" aria-labelledby="dLabel">
                    {% for b in branch %}
                    <li>
                        <a href="inventory/putSchedule?bid={{b.id}}">{{b.bname}}</a>
                        <li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            <br> {% if user.is_staff %}
            <button id="dLabel" type="button" class="btn btn-info btn-lg btn-block" data-toggle="modal" data-target="#getschedule">GET SCHEDULE(alpha)</button>
            <div class="modal fade" id="getschedule" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-body">
                            {% for b in branch %}
                                <button type="button" class="btn btn-info" onclick="getAcaButton(this,{{b.id}})">{{b.bname}}</button>
                            {% endfor %}
                        </div>

                        <div class="modal-body academypadding" id="specific">
                        </div>
                    </div>
                </div>
            </div>
            <!--<div class="dropdown">
                <button id="dLabel" type="button" class="btn btn-info btn-lg btn-block" data-toggle="dropdown" aria-expanded="true">GET SCHEDULE(alpha)</button>
                <ul class="dropdown-menu multi-level" role="menu" aria-labelledby="dropdownMenu">
                    {% for b in branch %}
                    <li class="dropdown-submenu">
                        <a href=#>{{b.location}}</a>
                        <ul class="dropdown-menu">
                            {% for a in academies %}
                                {% if b.id == a.bid %}
                                    <li>
                                      <a href="inventory/getSchedule?bid={{b.id}}&aid={{a.id}}&day=월">{{a.name}}</a>
                                    </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    <li>
                    {% endfor %}
                </ul>
            </div>-->
            {% endif %}
            <br>
            {% if user.is_staff %}
                <a id="dLabel" type="button" href='inventory/updateSchedule' class="btn btn-info btn-lg btn-block" aria-expanded="true">UPDATE SCHEDULE(alpha)</a>
            {% endif %}
            <!--{% if user.is_staff %}
            <button id="dLabel" type="button" class="btn btn-warning btn-lg btn-block" data-toggle="dropdown" aria-expanded="true" onclick="location.href='sturegi'">신입생 등록요청(테스트중)</button>
            {% endif %}-->
            <br>
        </div>
        <div class="col-xs-2 col-sm-4"></div>
    </div>
    <div class="row">
        <br>
        <div class="col-sm-4"></div>
        <div class="col-sm-4" id="schedule" align="center"></div>
        <div class="col-sm-4"></div>
    </div>
    {% else %}
    <div class="row">
        <br>
        <div class="col-sm-4"></div>
        <div class="col-sm-4" align="center">
            <a class="btn btn-success" href="/accounts/login">로그인이 필요합니다.</a>
        </div>
        <div class="col-sm-4"></div>
    </div>
    {% endif %}
</body>
<script>
    function getSchedule(gid) {
        $.ajax({
            type: 'POST',
            url: 'schedule',
            data: {
                gid: gid
            },
            success: function(resp) {
                var input = "";
                input += resp;
                document.getElementById("schedule").innerHTML = input;
                return true;
            }
        });
    }

    function getDriver(gid) {
        $.ajax({
            type: 'POST',
            url: 'driverschedule',
            data: {
                gid: gid
            },
            success: function(resp) {
                var input = "";
                input += resp;
                document.getElementById("schedule").innerHTML = input;
                return true;
            }
        });
    }

    function getDay(aid) {
        $.ajax({
            type: 'POST',
            url: 'day',
            data: {
                aid: aid
            },
            success: function(resp) {
                var input = "";
                input += resp;
                document.getElementById("schedule").innerHTML = input;
                return true;
            }
        });
    }

    function getDayDriver(gid) {
        $.ajax({
            type: 'POST',
            url: 'driverday',
            data: {
                gid: gid
            },
            success: function(resp) {
                var input = "";
                input += resp;
                document.getElementById("schedule").innerHTML = input;
                return true;
            }
        });
    }

    function updateDay(gid) {
        $.ajax({
            type: 'POST',
            url: 'updateDay',
            data: {
                gid: gid
            },
            success: function(resp) {
                var input = "";
                input += resp;
                document.getElementById("schedule").innerHTML = input;
                return true;
            }
        });
    }

    function updateDayAca(aid) {
        $.ajax({
            type: 'POST',
            url: 'uDay',
            data: {
                aid: aid
            },
            success: function(resp) {
                var input = "";
                input += resp;
                document.getElementById("schedule").innerHTML = input;
                return true;
            }
        });
    }

    function studata() {
        var UserAgent = navigator.userAgent;
        if (UserAgent.match(/iPhone|iPod|Android|Windows CE|BlackBerry|Symbian|Windows Phone|webOS|Opera Mini|Opera Mobi|POLARIS|IEMobile|lgtelecom|nokia|SonyEricsson/i) != null || UserAgent.match(/LG|SAMSUNG|Samsung/) != null) {
            alert("모바일은 지원하지 않습니다.");
        } else {
            location.href = "/studata";
        }
    }

    function getAcaButton(t, bid){
        $.ajax({
            type: 'GET',
            url: 'getAcaButton',
            data: {
                bid: bid
              },
            success: function(resp) {
                $('#specific').html(resp)
           }
         });
    }
</script>

</html>
